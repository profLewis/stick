# soundGarden

Test sound playback on the Waveshare Pico Audio board and associated speakers.

## Hardware

- **Raspberry Pi Pico 2** (RP2350)
- **Waveshare Pico Audio** (PCM5101A I2S DAC)
- **MIDI controller** (any standard MIDI keyboard/controller with DIN-5 output)

### I2S Audio Pins (Pico Audio board)

| Signal | GPIO | Description |
|--------|------|-------------|
| DIN    | GP26 | I2S serial data |
| BCK    | GP27 | I2S bit clock |
| LRCK   | GP28 | I2S word select |

The PCM5101A generates its own master clock internally — no MCLK wiring needed.

### MIDI Pins

| Signal | GPIO | Description |
|--------|------|-------------|
| RX     | GP1  | MIDI input (UART0, 31250 baud) |
| TX     | GP0  | MIDI output/thru (optional) |

Wire a standard DIN-5 MIDI connector with an optoisolator to GP1 for MIDI input.

## File Layout

```
soundGarden/
  install_sounds.py         # Host: deploy WAV files to Pico flash
  firmware/
    i2s_midi.py             # Pico: MIDI-triggered WAV playback via I2S
  sounds_source/            # 48 WAV files (C3-B6)
```

## Installation

Requires MicroPython on the Pico 2 and `mpremote` on the host:

```bash
pip install mpremote
```

### Install WAV files to Pico flash

```bash
python install_sounds.py
```

This will:
- Generate missing octaves by shifting existing WAV files (C3-B6 range)
- Auto-compress if flash space is tight (progressive: 22050 → 11025 → 5512 Hz)
- Skip files already up to date (smart sync via size + byte comparison)

Use `--force` to re-copy all files. Use `--list` to see what's on the device.

### Deploy firmware

```bash
mpremote cp firmware/i2s_midi.py :main.py
```

Reset the Pico to start. It will listen for MIDI Note On messages and play
the corresponding WAV file through the I2S audio output.

## How It Works

1. `i2s_midi.py` reads MIDI input on UART0 (GP1) at 31250 baud
2. On Note On, it maps the MIDI note number to a WAV filename (e.g. MIDI 60 = `C4.wav`)
3. The WAV file is streamed from flash through the I2S DAC to the audio output
4. New notes interrupt current playback
5. 8-bit WAV files are converted to 16-bit on the fly (I2S requires 16-bit minimum)

## Notes

- WAV files are 16-bit mono 44100 Hz originals, auto-compressed to fit in ~3 MB flash
- 48 notes cover C3 to B6 (MIDI 48-83)
- Octave 3 and upper octave 6 notes are generated by pitch-shifting octave 4-5 originals
- Note naming: `C4.wav`, `Cs4.wav` (C#4), `D4.wav`, etc.
